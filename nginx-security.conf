# Безопасная конфигурация Nginx для React SPA
server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;
    
    # Основные настройки безопасности  
    server_tokens off;
    
    # Блокируем попытки доступа к WordPress админке
    location ~* ^/(wp-admin|wp-login|wordpress|wp-content|wp-includes) {
        access_log /var/log/nginx/blocked.log;
        return 403;
    }
    
    # Блокируем попытки доступа к админским панелям
    location ~* ^/(admin|administrator|phpmyadmin|cpanel|panel) {
        access_log /var/log/nginx/blocked.log;  
        return 403;
    }
    
    # Блокируем подозрительные расширения
    location ~* \.(asp|aspx|jsp|cgi|pl|sh|py|exe)$ {
        access_log /var/log/nginx/blocked.log;
        return 403;
    }
    
    # Блокируем доступ к системным файлам
    location ~* ^/(\.|_|backup|old|temp|tmp|test|dev) {
        access_log /var/log/nginx/blocked.log;
        return 403;
    }
    
    # Блокируем HTTP методы кроме GET, POST, HEAD
    if ($request_method !~ ^(GET|HEAD|POST)$) {
        return 405;
    }
    
    # Статичные ресурсы (JS, CSS, изображения) с кешированием
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }
    
    # React SPA - все маршруты направляются на index.html
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # Безопасные заголовки
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;  
    add_header Referrer-Policy strict-origin-when-cross-origin always;
}